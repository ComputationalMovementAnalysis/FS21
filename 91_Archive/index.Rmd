---
title: "Patterns and Trends in Ecology / GEO880"
date: "`r Sys.Date()`"
documentclass: book
output: bookdown::gitbook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Lessons L1

## Introduction

For our practical R course building-up skills for analyzing movement data in the software environment R, you'll be using data from the ZHAW project "Wildtier und Mensch im Naherholungsraum"1. The project investigates the interaction and disturbance dynamics between animals living in habitats that are also used by humans as recreational areas. We'll study trajectories of _roe deer_ (dt. _Reh_) and mountain bikers, practicing the most basic analysis tasks of Computational Movement Analysis (CMA). 

Lesson L1 covers the necessary steps for getting ready in R and some basic concepts for setting up a well-structured R project. The lesson introduces how additional packages that provide useful functions are made available and how temporal data is handled. The lesson concludes with the creation of your first map featuring movement data.


*Please note* we are given this data under the condition of signing a non-disclosure agreement. Why? This is data coming out of an ongoing research project. Capturing wild living animals and then equipping them with GPS collars is a very labor and cost intensive form of research. Consequently, data resulting such campaigns is a very valuable asset that must be protected.


## Leaning outcomes
- You learn how to structure an R project.
- You can read movement data from a .csv-file into a data.frame and into a move object.
- You can manipulate time data.
- You can transform coordinates that come in Lat/Lon into Swiss plane coordinates, and vice versa.
- You can produce simple maps of your trajectory data using ggplot2 and ggmap.
- ~~You get to know the package move.~~


## Tasks

### Task 1

In Master_File.R you set the working directory (using setwd() ) . Here, you also manage the sourcing of all subsequent code listings (using source() ).


### Task 2
Install the packages ggplot2, lubridate, move, and ggmap. Google what these packages can do for you. In the file Packages_libraries.R you manage the code loading these packages, using the command library(). 

### Task 3
The R-file Rawdata_import.R manages all input tasks. Here you read your input files Roe_gps_all.csv and Roe_meta.csv. Use read.delim() for this task. Study the structure and content of the two input files by opening them in a text editor. The structure of the files helps you setting the arguments for read.delim().


### Task 4
Listing 1.1_read_in_roe.data.R will do some data filtering and tidying up. The R object Roe_gps_all features 11 variables. For the moment we will focus on a selection of those. Overwrite gps_roe_all and only keep variables (aka columns) "TierID", "LMT_Date", "LMT_Time", "DOP", "Latitude...." and "Longitude....".


### Task 5
Listing 1.2_format_date.time.R will help you handling time. R offers specific date/time object classes POSIXct and POSIXlt (what’s the difference?). Use POSIXct for the moment, with the assignment function as.POSIXct(). In the current data.frame you have two separate variables (aka columns) for date (LMT_Date) and time (LMT_Time), both of type “factor”. You’ll have to first concatenate the date and time (using the character manipulation function paste() ), then feed as.POSIXct() the new character string whilst specifying its format (using format = "%d.%m.%Y %H:%M:%S").

### Task 5
Find a way to filter just the data for July 2014.


### Task 6
Our data comes with Lat/Lon coordinates in WGS84. It is good practice to add to a trajectory data set also the Swiss plane coordinates LV03 (CH1903). Luckily, Swisstopo offers scripts that do this for us. Source the file WGS84_CH1903.R in your listing Packages_libraries.R and use the function WGS.to.CH.x and WGS.to.CH.y in the listing 1.3_transform_geocoordinates.R. Carefully study the results and check that you got the right coordinates


### Task 7
Make a first "map-like" plot of your data producing a simple scatterplot with ggplot2. Assign every individual animal its own colour (using the ggplot2 argument colour). Do you spot outliers? If so, get rid of the outliers. Plot your data again, this time without outliers. Save your plot using ggsave(). Save your code in the listing 1.4_plotting_ggplot.R. Setting up a ggplot with our data is done using the command ggplot(gps_roe_all, aes(X, Y, colour = TierID)). Creating a map is done via the basic scatterplot command geom_point(), using a fixed aspect ratio of 1.

### Task 8
Now we want to produce a nicer map with an OpenStreetMap basemap. This can be done with ggmap. First, you need to specify the extent of your map tile, then grab it from OSM. Note, that when working with ggmap we will have to use our WSG84 coordinates (lat/long). This is how it’s done:

```{r,eval=F}
myLocation = c(
  min(gps_roe_all$Lon), 
  min(gps_roe_all$Lat),
  max(gps_roe_all$Lon), 
  max(gps_roe_all$Lat)
)

myMap <- get_map(location=myLocation,source="osm", color="bw", crop=FALSE)

```
Note: Working with ggmap, you don’t set up your plot object using ggplot() like we did before, but using ggmap(myMap) instead. For importing the point/gps-data, use the variable “data = “ in the geom_point() layer. Adding the point component to the ggmap, is then done as follows:
```{r, eval = F}
geom_point(data = gps_roe_all, aes(Lon, Lat, colour = TierID, size = 3)
```

### Task 9
Finally, produce a simple map using the package move in the listing 1.5_plotting_move.R. Create the moveStack object  from your data stored in the data.frame gps_roe_all and name it gps_roe_move. Plot your map using the function plot(). Note that you also should assign your move object a coordinate reference system. You achieve this using the following command

```{r, eval = F}
proj4string(gps_roe_move) <- "+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=600000 +y_0=200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs" 
```


## Tips and suggestions

- This text suggests a structure and even names for your R-listings. These are the same as in the given .zip-Folder. Clearly, you are free to structure and name your code as you wish. However, after every lesson you will be given a code listing suggesting one solution to the given tasks, using the structure and names given above. So, using the same names will just make your life easier.
- The functions head() and tail() list the first or last 5 rows (or how many you specify explicitly though the argument n=10) of an R object to the console. We will often use it to get an idea of the content of a data.frame, but the commands also work for vectors, matrices, or functions.
- Adding variables (aka columns) to a data.frame is easy. For example, this command adds a new variable that contains for all rows the number 42.
dataSet$nameOfNewVariable <- 42
- Working with selected rows. Subset lets you select only certain rows of your data frame, for instance, by using a condition on one of the variables.
data_subset <- subset(data, data$variableName > 30)
- Working with selected columns. Sometimes it’s useful to create a data set that only contains some selected columns (aka variables) of the initial data set. Here is how you extract the second till the fourth column. Note, the first column has the index 1, not 0.
data_selectedColumns <- data[,2:4]
data_selectedColumns <- data[,c(“columnName1”, “columnName2”)]
- Our time values are recorded in Central European Time (CET). Note that Daylight Saving Time (DST) is not respected, so the data was recorded in CET all year. However, if we assign the time zone "CET", R will think that our Data DOES respect DST. In order to bypass this problem we can assign the time zone "Algiers". Algiers is in the time zone CET, but does NOT respect DST. Use the as.POSIXct() argument tz = “TimeZoneName”.

## Materials and Help

5. Materials and help

