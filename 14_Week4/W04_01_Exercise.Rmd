# Exercise 4
<!-- Operationalize and find meet patterns  -->
<!-- Visualize spatial distribution of meet -->
<!-- Define functions -->


## Learning Outcomes


## Prerequisites


## Preperation

## Tasks

### Task 1

Find spatial overlap

```{r}
## Task 1 ####################


mcp <- wildschwein_BE_sf %>%
  group_by(TierID) %>%
  summarise() %>%
  st_convex_hull()


overlap_spatial_mat <- overlap_spatial(mcp,"TierID")

```

### Task 2

Find temporal overlap

```{r}
## Task 2 ####################
library(lubridate)

wildschwein_intervals <- wildschwein_BE_sf %>%
  group_by(TierID) %>%
  summarise(
    min = min(DatetimeUTC,na.rm = T),
    max = max(DatetimeUTC,na.rm = T)
  ) %>%
  ungroup() %>%
  mutate(
    interval = interval(min,max)
  )

overlap_temporal_mat <- overlap_temporal(wildschwein_intervals,"interval","TierID")


```

### Task 3

Combine spatial and temporal overlap and generate datframe with "pairs"
```{r}

## Task 3 ####################

overlap_spat_temp <- overlap_temporal_mat & overlap_spatial_mat

overlap_spat_temp <- overlap_spat_temp %>%
  as.data.frame() %>%
  rownames_to_column("id1") %>%
  gather(id2,bool,-id1) %>%
  filter(bool == TRUE) %>%
  select(-bool)
```


### Task 4

Temporally join data and visualize.

<!-- Todo: remove errors -->
```{r}
## Task 4 ####################


# temporal_join(wildschwein_BE_sf,TierID,overlap_spat_temp$id1[1],overlap_spat_temp$id2[1],DatetimeUTC,mult = "first",0)
# 
# 
# ggplot(temporal_join) +
#   geom_point(aes(E2,N2), colour = "blue") +
#   geom_point(aes(E1,N1), colour = "red")
# 
# 
# leaflet(temporal_join) %>%
#   addCircles(lng = ~Long1,lat = ~Lat1) %>%
#   addTiles()

```



## Solutions (RCode)

```{r code=readLines('14_Week4/RFiles/W04_01_Exercise.R'), results='asis', echo = T, include=T, eval=F}
```
