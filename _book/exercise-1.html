<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>GEO880: Patterns and Trends in Environmental Data</title>
  <meta name="description" content="GEO880: Patterns and Trends in Environmental Data">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="GEO880: Patterns and Trends in Environmental Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="GEO880: Patterns and Trends in Environmental Data" />
  
  
  

<meta name="author" content="Patrick Laube and Nils Ratnaweera">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="exercise-2.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction Chapter</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i>Exercise 1</a><ul>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#leaning-outcomes"><i class="fa fa-check"></i>Leaning outcomes</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#preperation"><i class="fa fa-check"></i>Preperation</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#tasks-and-inputs"><i class="fa fa-check"></i>Tasks and inputs</a><ul>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-1-initialize-project"><i class="fa fa-check"></i>Task 1: Initialize project</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-2-import-data"><i class="fa fa-check"></i>Task 2: Import data</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-3-explore-data"><i class="fa fa-check"></i>Task 3: Explore Data</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#input-handling-spatial-data"><i class="fa fa-check"></i>Input: Handling spatial data</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-4-project-data-from-wgs84"><i class="fa fa-check"></i>Task 4: Project data from WGS84</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#input-calculate-convex-hull"><i class="fa fa-check"></i>Input: Calculate Convex Hull</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-5-ploting-spatial-objects"><i class="fa fa-check"></i>Task 5: Ploting spatial objects</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-6-adding-a-background-map"><i class="fa fa-check"></i>Task 6: Adding a background map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i>Exercise 2</a><ul>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#learning-outcomes"><i class="fa fa-check"></i>Learning Outcomes</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#preperation-1"><i class="fa fa-check"></i>Preperation</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#demo-tidyverse"><i class="fa fa-check"></i>Demo Tidyverse</a><ul>
<li><a href="exercise-2.html#difftime"><code>difftime</code></a></li>
<li><a href="exercise-2.html#lead-lag"><code>lead()</code> / <code>lag()</code></a></li>
<li><a href="exercise-2.html#mutate"><code>mutate()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#tasks-and-inputs-1"><i class="fa fa-check"></i>Tasks and Inputs</a><ul>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-1-getting-an-overview"><i class="fa fa-check"></i>Task 1: Getting an Overview</a></li>
<li><a href="exercise-2.html#input-cut-vector-by-intervals">Input: <code>cut()</code> vector by intervals</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-2-making-groups-by-sampling-interval"><i class="fa fa-check"></i>Task 2: Making groups by sampling Interval</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#input-geometry-as-columns"><i class="fa fa-check"></i>Input: Geometry as columns</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-3-deriving-movement-parameters-i-euclidean-distance-and-speed"><i class="fa fa-check"></i>Task 3: Deriving movement parameters I: Euclidean Distance and Speed</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-4"><i class="fa fa-check"></i>Task 4</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-5-optional-deriving-movement-parameters-ii-rolling-window-functions"><i class="fa fa-check"></i>Task 5 (Optional): Deriving movement parameters II: Rolling window functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#solutions-rcode"><i class="fa fa-check"></i>Solutions (RCode)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEO880: Patterns and Trends in Environmental Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-1" class="section level1">
<h1>Exercise 1</h1>
<!-- '- Set up Rstudio Project -->
<!-- - Import and clean data -->
<!-- - Explore Dataset: remove outliers, find sampling interval, make subsets and find overlapping areas of individuals) -->
<!-- - Make my first simple map -->
<p>Exercise 1 covers the necessary steps for getting ready in <code>R</code> and some basic concepts for setting up a well-structured <code>R</code> project. The lesson introduces how additional packages that provide useful functions for data science are made available and how spatial data is handled. The exercise concludes with the creation of your first map featuring movement data.</p>
<div id="leaning-outcomes" class="section level2">
<h2>Leaning outcomes</h2>
<ul>
<li>You learn how to structure an <code>R</code> project.</li>
<li>You can read movement data from a .csv-file into a <code>data.frame</code></li>
<li>You can convert spatial point data from a <code>data.frame</code> to a spatial object <code>sf</code></li>
<li>You can perform basic spatial operations on spatial objects in <code>R</code></li>
<li>You can produce simple maps of your spatial data using <code>ggplot2</code></li>
</ul>
</div>
<div id="prerequisites" class="section level2">
<h2>Prerequisites</h2>
<p>Readings Skills from “R for Data Science” <span class="citation">(Wickham and Grolemund 2017)</span>:</p>
<ul>
<li>RS1.1 Preface (16p, ix-xxiv)</li>
<li>RS1.2 Chap2 Workflow basics (3p, 37-39)</li>
<li>RS1.3 Chap4 Workflow scripts (3p, 77-79)</li>
<li>RS1.4 Chap6 workflow projects (6p, 111-116)</li>
<li>RS1.5 Chap8 Data Import with <code>readr</code> (21p)</li>
<li>RS1.6 Chap13 Date and Times with <code>lubridate</code> (18p, 237-256)</li>
</ul>
</div>
<div id="preperation" class="section level2">
<h2>Preperation</h2>
<p>If you haven’t already, install the packages <code>tidyverse</code>, and <code>devtools</code> (using <code>install.packages()</code>). Use <code>devtools</code> to install the newest version of <code>ggplot</code><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> from github (see code below). Additionally, install the packages <code>sf</code><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>, <code>raster</code> and <code>ggspatial</code>. <strong>Restart your <code>R</code> session after installing all these packages.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
devtools::<span class="kw">install_github</span>(<span class="st">&quot;tidyverse/ggplot2&quot;</span>)

<span class="co"># run the following line only if you are working on RStudio Server</span>
<span class="kw">install.packages</span>(<span class="st">&#39;udunits2&#39;</span>, <span class="dt">type =</span> <span class="st">&quot;source&quot;</span>, <span class="dt">repo =</span> <span class="st">&quot;cran.rstudio.com&quot;</span>, <span class="dt">configure.args=</span><span class="st">&quot;--with-udunits2-include=/usr/include/udunits2&quot;</span>)

<span class="kw">install.packages</span>(<span class="st">&quot;sf&quot;</span>)



<span class="kw">install.packages</span>(<span class="st">&quot;raster&quot;</span>)
<span class="kw">install.packages</span>(<span class="st">&quot;ggspatial&quot;</span>)</code></pre></div>
</div>
<div id="tasks-and-inputs" class="section level2">
<h2>Tasks and inputs</h2>
<div id="task-1-initialize-project" class="section level3">
<h3>Task 1: Initialize project</h3>
<p>Create a new <em>RStudio Project</em>. As recommended in <span class="citation">Wickham and Grolemund (2017)</span>, remove the option “<em>Restore .RData into workspace at startup</em>” and set the option “<em>save workspace to .RData on exit</em>” to “<em>Never</em>”.</p>
<p>Create a new R-File and divide it into the sections necessary in a classical Data Science Workflow. We recommend following sections:</p>
<ul>
<li>Loading environment / libraries</li>
<li>Data import</li>
<li>Data cleansing</li>
<li>Data analysis and visualization</li>
</ul>
<p>“Sections” can be created within RStudio by adding Comments (<code>#</code>) with at least 4 trailing dashes (<code>-</code>), equal signs (<code>=</code>), or pound signs (<code>#</code>). Sections allow code folding (try clicking on the small triangle next to the line number) and facilitate navigation (try the shortcut: <code>Shift</code>+<code>Alt</code>+<code>J</code>).</p>
<p>Load the package <code>tidyverse</code> in the appropriate section.</p>
</div>
<div id="task-2-import-data" class="section level3">
<h3>Task 2: Import data</h3>
<p>In section “data import”, import the file <code>wildschwein_BE.csv</code>.</p>
<p>Note:</p>
<ul>
<li>If your are using <a href="https://support.rstudio.com/hc/en-us/articles/218611977-Importing-Data-with-RStudio">a graphical tool</a> to import your code, make sure you save the corresponding code in your R Script. This is important in regard to the reproducibility of your script and will ensure that your workflow is documented without gaps. We’d rather recommend to move away from using graphical tools and focus on using code.</li>
<li>We recommend using one of the <code>tidyverse</code> functions (<code>read_*</code>) to import your data. These functions are less error prone than the base <code>R</code> functions (<code>read.*</code>). Specifically for the wild boar data, we recommend <code>read_delim()</code>.</li>
<li>If you use <code>read_delim()</code> and receive warnings during import, have a look at these warnings by using the function <code>problems()</code>. Resolve these problems until import runs without warnings.</li>
<li>Assign correct data types as necessary and make sure the time zone is set correctly for the date/time column.</li>
<li>For everyone working on the RStudio Server: You will first need to upload this data to the server using the “<em>upload</em>”-button in the “<em>Files</em>” tab.</li>
</ul>
</div>
<div id="task-3-explore-data" class="section level3">
<h3>Task 3: Explore Data</h3>
<p>We will use a range of different plotting techniques in this course. Several plotting techniques have emerged in recent years, each with their specific strengths and weaknesses. While <code>base::plot()</code>is quick and simple, it not very scalable with growing complexity. <code>ggplot</code> offers solutions for most use cases and has a elegant syntax that is easy to get accustomed to. We will get to know other techniques later in the course.</p>
<p>Get an overview of your data by creating a first “map-like” plot of your data producing a simple scatter plot with <code>ggplot</code>. Do you spot outliers? If so, get rid of the outliers and plot your data again without outliers.</p>
<p>Setting up a <code>ggplot</code> with our data is done using the command <code>ggplot(wildschwein_BE, aes(Long, Lat, colour = TierID))</code>. Creating a map is done via the basic scatter plot command <code>geom_point()</code>. Use <code>coord_map()</code> to get a reasonable aspect ratio of <code>Lat</code> and <code>Long</code>. Assigning every individual its own colour is done using the <code>ggplot</code> argument <code>colour =</code>.</p>
<p>Save your code in the appropriate section.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="input-handling-spatial-data" class="section level3">
<h3>Input: Handling spatial data</h3>
<p>Until now, we’ve handled spatial data within data frames. This works well for many tasks, but sometimes we need special <em>spatial</em> classes to handle our trajectories. We will get to now such cases in our next tasks, but first we need to convert our <code>data.frame</code> into a spatial object. Some of you might be familiar with the <code>sp</code> package with the classes <code>SpatialPoints</code>, <code>SpatialPointsDataFrame</code> and so on. Just recently the new and exiting package <code>sf</code>, was released on CRAN. <code>sf</code> has some huge advantages over sp:</p>
<ul>
<li>simple features are essentially data frames, which mean they interface with the <code>tidyverse</code><br />
</li>
<li>comply with the common Open Geospatial Consortium (OGC) standards (ISO 19125-1:2004) and interface with other important spatial tools such as GDAL, PostGIS, GeoJSON and so fourth</li>
<li>are being rapidly implemented in visualisation tools such as <code>ggplot2</code>, <code>plotly</code> and <code>tmap</code></li>
</ul>
<p>We will largely rely on <code>sf</code>when working with vector data in <code>R</code>. In order to transform our <code>data.frame</code> into an sf object, we need to use the function <code>st_as_sf()</code> while specifying the columns storing the coordinates and the coordinate reference system<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(sf)

wildschwein_BE_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(wildschwein_BE, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;Long&quot;</span>, <span class="st">&quot;Lat&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</code></pre></div>
<p>Notice how <code>st_as_sf</code> takes the EPSG code for the <code>crs =</code> argument. This is so much easier and more elegant than using <code>PROJ.4</code> or <code>WKT</code>. You can find a lot of useful information on Coordinate Reference Systems (including EPSG Codes , etc.) under <a href="http://spatialreference.org/ref/epsg/2056/">spatialreference.org</a> or <a href="http://epsg.io" class="uri">http://epsg.io</a>.</p>
<p>Let’s compare our original <code>data.frame</code> with this new <code>sf</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE</code></pre></div>
<pre><code>## # A tibble: 141,763 x 6
##    TierID TierName CollarID DatetimeUTC           Lat  Long
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;
##  1 001A   Ueli        12272 2014-05-28 21:01:14  47.0  7.05
##  2 001A   Ueli        12272 2014-05-28 21:15:18  47.0  7.05
##  3 001A   Ueli        12272 2014-05-28 21:30:13  47.0  7.05
##  4 001A   Ueli        12272 2014-05-28 21:45:11  47.0  7.05
##  5 001A   Ueli        12272 2014-05-28 22:00:33  47.0  7.05
##  6 001A   Ueli        12272 2014-05-28 22:15:16  47.0  7.05
##  7 001A   Ueli        12272 2014-05-28 22:30:14  47.0  7.05
##  8 001A   Ueli        12272 2014-05-28 22:45:09  47.0  7.05
##  9 001A   Ueli        12272 2014-05-28 23:00:12  47.0  7.05
## 10 001A   Ueli        12272 2014-05-28 23:15:08  47.0  7.05
## # ... with 141,753 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE_sf</code></pre></div>
<pre><code>## Simple feature collection with 141763 features and 4 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 7.019889 ymin: 46.96389 xmax: 7.136615 ymax: 47.01882
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 141,763 x 5
##    TierID TierName CollarID DatetimeUTC                    geometry
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;                      &lt;POINT [°]&gt;
##  1 001A   Ueli        12272 2014-05-28 21:01:14 (7.049359 46.99378)
##  2 001A   Ueli        12272 2014-05-28 21:15:18 (7.049342 46.99383)
##  3 001A   Ueli        12272 2014-05-28 21:30:13 (7.049367 46.99379)
##  4 001A   Ueli        12272 2014-05-28 21:45:11 (7.049329 46.99383)
##  5 001A   Ueli        12272 2014-05-28 22:00:33 (7.049336 46.99376)
##  6 001A   Ueli        12272 2014-05-28 22:15:16 (7.049282 46.99385)
##  7 001A   Ueli        12272 2014-05-28 22:30:14 (7.049401 46.99381)
##  8 001A   Ueli        12272 2014-05-28 22:45:09  (7.051912 46.9958)
##  9 001A   Ueli        12272 2014-05-28 23:00:12  (7.051797 46.9958)
## 10 001A   Ueli        12272 2014-05-28 23:15:08 (7.051658 46.99582)
## # ... with 141,753 more rows</code></pre>
<p>As you can see, <code>st_as_sf()</code> has added some metadata to our dataframe (<code>geometry type</code>, <code>dimension</code>, <code>bbox</code>, <code>epsg</code> and <code>proj4string</code>) and replaced the columns <code>Lat</code> and <code>Long</code> with a column named <code>geometry</code>. Other than that, the new <code>sf</code> object is very similar to our original dataframe. In fact, <code>sf</code> objects <em>are</em> essentially <code>dataframes</code>, just ask <code>R</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.data.frame</span>(wildschwein_BE_sf)
## [1] TRUE</code></pre></div>
<p>All operations we know from handling <code>data.frames</code> can be used on the <code>sf</code> object. Try some out!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># subset rows</span>
wildschwein_BE_sf[<span class="dv">1</span>:<span class="dv">10</span>,]
wildschwein_BE_sf[wildschwein_BE_sf$TierName ==<span class="st"> &quot;Ueli&quot;</span>,]

<span class="co"># subset colums</span>
wildschwein_BE_sf[,<span class="dv">2</span>:<span class="dv">3</span>]</code></pre></div>
<p>Instead of keeping the same data twice (once as a <code>data.frame</code>, and once as an <code>sf</code> object), we will overwrite the <code>data.frame</code> and continue working with the <code>sf</code> object from now on. This saves some memory space in <code>R</code> and avoids confusion. It is however, unideal that the <code>st_as_sf()</code> operation <em>replaced</em> the <code>Lat</code> and <code>Long</code> columns with the <code>geometry</code> column. It would be helpful to retain the <code>Lat</code>/<code>Long</code> columns and have the <code>geometry</code> column <em>in addition</em>. We can enforce this by using the argument <code>remove = FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE =<span class="st"> </span><span class="kw">st_as_sf</span>(wildschwein_BE, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;Long&quot;</span>, <span class="st">&quot;Lat&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>,<span class="dt">remove =</span> <span class="ot">FALSE</span>)

wildschwein_BE <span class="co"># note how the Lat/Long information is stored twice</span>
## Simple feature collection with 141763 features and 6 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 7.019889 ymin: 46.96389 xmax: 7.136615 ymax: 47.01882
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 141,763 x 7
##    TierID TierName CollarID DatetimeUTC           Lat  Long
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;
##  1 001A   Ueli        12272 2014-05-28 21:01:14  47.0  7.05
##  2 001A   Ueli        12272 2014-05-28 21:15:18  47.0  7.05
##  3 001A   Ueli        12272 2014-05-28 21:30:13  47.0  7.05
##  4 001A   Ueli        12272 2014-05-28 21:45:11  47.0  7.05
##  5 001A   Ueli        12272 2014-05-28 22:00:33  47.0  7.05
##  6 001A   Ueli        12272 2014-05-28 22:15:16  47.0  7.05
##  7 001A   Ueli        12272 2014-05-28 22:30:14  47.0  7.05
##  8 001A   Ueli        12272 2014-05-28 22:45:09  47.0  7.05
##  9 001A   Ueli        12272 2014-05-28 23:00:12  47.0  7.05
## 10 001A   Ueli        12272 2014-05-28 23:15:08  47.0  7.05
## # ... with 141,753 more rows, and 1 more variable: geometry &lt;POINT [°]&gt;

<span class="kw">rm</span>(wildschwein_BE_sf) <span class="co"># we can remove this sf object, since it just eats up our memory</span></code></pre></div>
</div>
<div id="task-4-project-data-from-wgs84" class="section level3">
<h3>Task 4: Project data from WGS84</h3>
<p>So what can we do with our new <code>sf</code> object that we couldn’t before? One example is projecting the WGS84 (<code>Lat</code>/<code>Long</code>) coordinates into the new Swiss CRS <code>CH1903+ LV95</code><a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>. Do this by using the function <code>st_transform</code>. By the way, do you notice a pattern here? The package <code>sf</code> names most functions for spatial operations with the prefix <code>st_*</code>.</p>
<p>Here’s the resulting <code>sf</code> object from the operation:</p>
<pre><code>## Simple feature collection with 141763 features and 6 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 2568153 ymin: 1201483 xmax: 2577023 ymax: 1207609
## epsg (SRID):    2056
## proj4string:    +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs
## # A tibble: 141,763 x 7
##    TierID TierName CollarID DatetimeUTC           Lat  Long
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;
##  1 001A   Ueli        12272 2014-05-28 21:01:14  47.0  7.05
##  2 001A   Ueli        12272 2014-05-28 21:15:18  47.0  7.05
##  3 001A   Ueli        12272 2014-05-28 21:30:13  47.0  7.05
##  4 001A   Ueli        12272 2014-05-28 21:45:11  47.0  7.05
##  5 001A   Ueli        12272 2014-05-28 22:00:33  47.0  7.05
##  6 001A   Ueli        12272 2014-05-28 22:15:16  47.0  7.05
##  7 001A   Ueli        12272 2014-05-28 22:30:14  47.0  7.05
##  8 001A   Ueli        12272 2014-05-28 22:45:09  47.0  7.05
##  9 001A   Ueli        12272 2014-05-28 23:00:12  47.0  7.05
## 10 001A   Ueli        12272 2014-05-28 23:15:08  47.0  7.05
## # ... with 141,753 more rows, and 1 more variable: geometry &lt;POINT [m]&gt;</code></pre>
</div>
<div id="input-calculate-convex-hull" class="section level3">
<h3>Input: Calculate Convex Hull</h3>
<p>Transforming from one Coordinate Reference System to another was one operation where we needed an object with a spatial nature. In this way, we were able to use an off the shelf function to project the coordinates from one CRS to another. In our next example, we again rely on a spatial function: We want to calculate a <a href="https://en.wikipedia.org/wiki/Convex_hull">convex hull</a> per Wild boar. And guess what the function for calculating a convex hull is called in <code>sf</code>? If you fuessed <code>st_convex_hull()</code>, you were right!</p>
<p>Before we can ferform <code>st_convex_hull()</code>, we need to add a grouping variable to our <code>sf</code> object, so that the convex hull is calculated <em>per animal</em>. Note:</p>
<ul>
<li>Grouping (via <code>group_by()</code>) has no effect on our original data frame</li>
<li>Effects of <code>group_by()</code> only take effect when manipulations are performed on the data.frame via <code>summarise()</code> or <code>mutate()</code></li>
<li>If you know <code>summarise()</code> and <code>mutate()</code> operations from <code>dplyr</code>; <code>sf</code> understands this language which facilitates handling spatial data</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE &lt;-<span class="st"> </span><span class="kw">group_by</span>(wildschwein_BE,TierID)</code></pre></div>
<p>You can see the grouping variable in the metadata of our <code>sf</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE
## Simple feature collection with 141763 features and 6 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 2568153 ymin: 1201483 xmax: 2577023 ymax: 1207609
## epsg (SRID):    2056
## proj4string:    +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs
## # A tibble: 141,763 x 7
## # Groups:   TierID [10]
##    TierID TierName CollarID DatetimeUTC           Lat  Long
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;
##  1 001A   Ueli        12272 2014-05-28 21:01:14  47.0  7.05
##  2 001A   Ueli        12272 2014-05-28 21:15:18  47.0  7.05
##  3 001A   Ueli        12272 2014-05-28 21:30:13  47.0  7.05
##  4 001A   Ueli        12272 2014-05-28 21:45:11  47.0  7.05
##  5 001A   Ueli        12272 2014-05-28 22:00:33  47.0  7.05
##  6 001A   Ueli        12272 2014-05-28 22:15:16  47.0  7.05
##  7 001A   Ueli        12272 2014-05-28 22:30:14  47.0  7.05
##  8 001A   Ueli        12272 2014-05-28 22:45:09  47.0  7.05
##  9 001A   Ueli        12272 2014-05-28 23:00:12  47.0  7.05
## 10 001A   Ueli        12272 2014-05-28 23:15:08  47.0  7.05
## # ... with 141,753 more rows, and 1 more variable: geometry &lt;POINT [m]&gt;</code></pre></div>
<p>In order for <code>sf_convex_hull()</code> to respect the grouping variable, we need to warp the <code>sf</code> object within <code>summarise()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mcp &lt;-<span class="st"> </span><span class="kw">st_convex_hull</span>(<span class="kw">summarise</span>(wildschwein_BE))</code></pre></div>
</div>
<div id="task-5-ploting-spatial-objects" class="section level3">
<h3>Task 5: Ploting spatial objects</h3>
<p>Using base plot to visualize <code>sf</code> objects is easy enough, just try the following code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(mcp)</code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>But since we use <code>ggplot</code> extensively, try and plot the object <code>mcp</code> with <code>ggplot</code>. Hint: Since you installed the newest version from github, you now use the function <code>geom_sf()</code> to add an <code>sf</code> object.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Note:</p>
<ul>
<li><code>ggplot</code> refuses to use our specified CRS, so we need to force this by specifying <code>coord_sf()</code></li>
<li>Oddly, it is not sufficient to specify the <code>crs =</code> wit hin <code>coord_sf()</code>, we need to pass our EPSG code to <code>datum =</code>.</li>
<li>You can change the plot style by making adjustments within <code>theme()</code> I recommend the following adjustments:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">theme</span>(
  <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>,
  <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;transparent&quot;</span>),
  <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),
  <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),
  <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),
  <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>()
  )</code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="task-6-adding-a-background-map" class="section level3">
<h3>Task 6: Adding a background map</h3>
<p>In order to add a background map to our plot, we will need to load two additional libraries: <code>raster</code> to load raster files and <code>ggspatial</code> to plot raster files in <code>ggplot</code>. Load these libraries now, and import the file <code>pk100_BE_2056.tif</code> (available on moodle) using the function <code>brick()</code>. Add the newly created <code>RasterBrick</code> object to ggplot using the function <code>geom_spraster_rgb()</code>.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<!-- ## Solutions (RCode) -->
<!-- ```{r code=readLines('11_Week1/RFiles/W01_01_Exercise.R'), results='asis', echo = T, include=T, eval=F} -->
<!-- ``` -->

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>We will need the newest version of <code>ggplot2</code> to plot spatial <code>sf</code> objects.<a href="exercise-1.html#fnref1">↩</a></p></li>
<li id="fn2"><p>If you are working on RStudio Server, you will need to install <code>udunits2</code> with some additional parameters (see code example).<a href="exercise-1.html#fnref2">↩</a></p></li>
<li id="fn3"><p>At this point, we assume you know what a Coordinate Reference Systems is. Check out <a href="https://earthdatascience.org/courses/earth-analytics/spatial-data-r/intro-to-coordinate-reference-systems/">this link</a> if this is not the case.<a href="exercise-1.html#fnref3">↩</a></p></li>
<li id="fn4"><p>As we’ve mentioned in the first Input, you can look up the EPSG codes under <a href="http://spatialreference.org/ref/epsg/2056/">spatialreference.org</a> or <a href="http://epsg.io" class="uri">http://epsg.io</a>. For information specific to switzerland switzerland, check the <a href="https://www.swisstopo.admin.ch/en/knowledge-facts/surveying-geodesy/reference-systems.html">swisstopo website</a><a href="exercise-1.html#fnref4">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
