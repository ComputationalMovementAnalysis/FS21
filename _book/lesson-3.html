<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>GEO880: Patterns and Trends in Environmental Data</title>
  <meta name="description" content="GEO880: Patterns and Trends in Environmental Data">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="GEO880: Patterns and Trends in Environmental Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="GEO880: Patterns and Trends in Environmental Data" />
  
  
  

<meta name="author" content="Patrick Laube and Nils Ratnaweera">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="lesson-2.html">
<link rel="next" href="lesson-4.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.0/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<script src="libs/leaflet-binding-2.0.0/leaflet.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction Chapter</a></li>
<li class="chapter" data-level="2" data-path="lesson-1.html"><a href="lesson-1.html"><i class="fa fa-check"></i><b>2</b> Lesson 1</a><ul>
<li class="chapter" data-level="2.1" data-path="lesson-1.html"><a href="lesson-1.html#leaning-outcomes"><i class="fa fa-check"></i><b>2.1</b> Leaning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="lesson-1.html"><a href="lesson-1.html#prerequisites"><i class="fa fa-check"></i><b>2.2</b> Prerequisites</a></li>
<li class="chapter" data-level="2.3" data-path="lesson-1.html"><a href="lesson-1.html#tasks"><i class="fa fa-check"></i><b>2.3</b> Tasks</a><ul>
<li class="chapter" data-level="2.3.1" data-path="lesson-1.html"><a href="lesson-1.html#task-1-prepare-project"><i class="fa fa-check"></i><b>2.3.1</b> Task 1: Prepare project</a></li>
<li class="chapter" data-level="2.3.2" data-path="lesson-1.html"><a href="lesson-1.html#task-2-import-data"><i class="fa fa-check"></i><b>2.3.2</b> Task 2: Import data</a></li>
<li class="chapter" data-level="2.3.3" data-path="lesson-1.html"><a href="lesson-1.html#task-3-explore-data"><i class="fa fa-check"></i><b>2.3.3</b> Task 3 Explore Data</a></li>
<li class="chapter" data-level="2.3.4" data-path="lesson-1.html"><a href="lesson-1.html#task-4-handling-spatial-data"><i class="fa fa-check"></i><b>2.3.4</b> Task 4: Handling spatial data</a></li>
<li class="chapter" data-level="2.3.5" data-path="lesson-1.html"><a href="lesson-1.html#task-5"><i class="fa fa-check"></i><b>2.3.5</b> Task 5</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lesson-1.html"><a href="lesson-1.html#solutions-rcode"><i class="fa fa-check"></i><b>2.4</b> Solutions (RCode)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="lesson-2.html"><a href="lesson-2.html"><i class="fa fa-check"></i><b>3</b> Lesson 2</a><ul>
<li class="chapter" data-level="3.1" data-path="lesson-2.html"><a href="lesson-2.html#learning-outcomes"><i class="fa fa-check"></i><b>3.1</b> Learning Outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="lesson-2.html"><a href="lesson-2.html#prerequisites-1"><i class="fa fa-check"></i><b>3.2</b> Prerequisites</a></li>
<li class="chapter" data-level="3.3" data-path="lesson-2.html"><a href="lesson-2.html#preperation"><i class="fa fa-check"></i><b>3.3</b> Preperation</a></li>
<li class="chapter" data-level="3.4" data-path="lesson-2.html"><a href="lesson-2.html#tasks-1"><i class="fa fa-check"></i><b>3.4</b> Tasks</a><ul>
<li class="chapter" data-level="3.4.1" data-path="lesson-2.html"><a href="lesson-2.html#task-1"><i class="fa fa-check"></i><b>3.4.1</b> Task 1</a></li>
<li class="chapter" data-level="3.4.2" data-path="lesson-2.html"><a href="lesson-2.html#task-2"><i class="fa fa-check"></i><b>3.4.2</b> Task 2</a></li>
<li class="chapter" data-level="3.4.3" data-path="lesson-2.html"><a href="lesson-2.html#task-3"><i class="fa fa-check"></i><b>3.4.3</b> Task 3</a></li>
<li class="chapter" data-level="3.4.4" data-path="lesson-2.html"><a href="lesson-2.html#task-4"><i class="fa fa-check"></i><b>3.4.4</b> Task 4</a></li>
<li class="chapter" data-level="3.4.5" data-path="lesson-2.html"><a href="lesson-2.html#task-5-1"><i class="fa fa-check"></i><b>3.4.5</b> Task 5</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="lesson-2.html"><a href="lesson-2.html#solutions-rcode-1"><i class="fa fa-check"></i><b>3.5</b> Solutions (RCode)</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="lesson-3.html"><a href="lesson-3.html"><i class="fa fa-check"></i><b>4</b> Lesson 3</a><ul>
<li class="chapter" data-level="4.1" data-path="lesson-3.html"><a href="lesson-3.html#learning-outcomes-1"><i class="fa fa-check"></i><b>4.1</b> Learning Outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="lesson-3.html"><a href="lesson-3.html#prerequisites-2"><i class="fa fa-check"></i><b>4.2</b> Prerequisites</a></li>
<li class="chapter" data-level="4.3" data-path="lesson-3.html"><a href="lesson-3.html#preperation-1"><i class="fa fa-check"></i><b>4.3</b> Preperation</a></li>
<li class="chapter" data-level="4.4" data-path="lesson-3.html"><a href="lesson-3.html#tasks-2"><i class="fa fa-check"></i><b>4.4</b> Tasks</a><ul>
<li class="chapter" data-level="4.4.1" data-path="lesson-3.html"><a href="lesson-3.html#task-1-1"><i class="fa fa-check"></i><b>4.4.1</b> Task 1</a></li>
<li class="chapter" data-level="4.4.2" data-path="lesson-3.html"><a href="lesson-3.html#task-2-1"><i class="fa fa-check"></i><b>4.4.2</b> Task 2</a></li>
<li class="chapter" data-level="4.4.3" data-path="lesson-3.html"><a href="lesson-3.html#task-3-optional"><i class="fa fa-check"></i><b>4.4.3</b> Task 3 (Optional)</a></li>
<li class="chapter" data-level="4.4.4" data-path="lesson-3.html"><a href="lesson-3.html#task-4-1"><i class="fa fa-check"></i><b>4.4.4</b> Task 4</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="lesson-3.html"><a href="lesson-3.html#solution-r-code"><i class="fa fa-check"></i><b>4.5</b> Solution (R Code)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lesson-4.html"><a href="lesson-4.html"><i class="fa fa-check"></i><b>5</b> Lesson 4</a><ul>
<li class="chapter" data-level="5.1" data-path="lesson-4.html"><a href="lesson-4.html#learning-outcomes-2"><i class="fa fa-check"></i><b>5.1</b> Learning Outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="lesson-4.html"><a href="lesson-4.html#prerequisites-3"><i class="fa fa-check"></i><b>5.2</b> Prerequisites</a></li>
<li class="chapter" data-level="5.3" data-path="lesson-4.html"><a href="lesson-4.html#preperation-2"><i class="fa fa-check"></i><b>5.3</b> Preperation</a></li>
<li class="chapter" data-level="5.4" data-path="lesson-4.html"><a href="lesson-4.html#tasks-3"><i class="fa fa-check"></i><b>5.4</b> Tasks</a><ul>
<li class="chapter" data-level="5.4.1" data-path="lesson-4.html"><a href="lesson-4.html#task-1-2"><i class="fa fa-check"></i><b>5.4.1</b> Task 1</a></li>
<li class="chapter" data-level="5.4.2" data-path="lesson-4.html"><a href="lesson-4.html#task-2-2"><i class="fa fa-check"></i><b>5.4.2</b> Task 2</a></li>
<li class="chapter" data-level="5.4.3" data-path="lesson-4.html"><a href="lesson-4.html#task-3-1"><i class="fa fa-check"></i><b>5.4.3</b> Task 3</a></li>
<li class="chapter" data-level="5.4.4" data-path="lesson-4.html"><a href="lesson-4.html#task-4-2"><i class="fa fa-check"></i><b>5.4.4</b> Task 4</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="lesson-4.html"><a href="lesson-4.html#solutions-rcode-2"><i class="fa fa-check"></i><b>5.5</b> Solutions (RCode)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="individual-project.html"><a href="individual-project.html"><i class="fa fa-check"></i><b>6</b> Individual Project</a><ul>
<li class="chapter" data-level="6.1" data-path="individual-project.html"><a href="individual-project.html#possible-topics"><i class="fa fa-check"></i><b>6.1</b> Possible topics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEO880: Patterns and Trends in Environmental Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lesson-3" class="section level1">
<h1><span class="header-section-number">4</span> Lesson 3</h1>
<!-- Stops and moves -->
<!-- Trajectory segmentation -->
<!-- Similarity measures and clustering -->
<div id="learning-outcomes-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Learning Outcomes</h2>
<ul>
<li>You are able to segment a trajectory using <span class="citation">Laube and Purves (2011)</span></li>
<li>You are able to compute the similarity between given trajectories using the package <code>SimilarityMeasures.</code></li>
<li>You acquire further useful data processing skills. <!-- Todo: passt das noch? --></li>
</ul>
</div>
<div id="prerequisites-2" class="section level2">
<h2><span class="header-section-number">4.2</span> Prerequisites</h2>
<p>Readings Skills from “R for Data Science” <span class="citation">(Wickham and Grolemund 2017)</span>:</p>
<ul>
<li>RS3.1 Chap1 Data visualization with ggplot2 (31, 3-35)</li>
<li>RS3.2 Chap5 Exploratory Data Analysis (28p, 81.109)</li>
</ul>
<p>Readings Theory <span class="citation">Alan Both (2018)</span> A Comparative Analysis of Trajectory Similarity Measures: Recommendations for Selection and Use, in review with PLOS ONE, confidential. <!-- ToDO: get update on the package similarity measures --></p>
</div>
<div id="preperation-1" class="section level2">
<h2><span class="header-section-number">4.3</span> Preperation</h2>
</div>
<div id="tasks-2" class="section level2">
<h2><span class="header-section-number">4.4</span> Tasks</h2>
<div id="task-1-1" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Task 1</h3>
<p>Picking up at Task 4 from last week: we can now implement this algorithm using the <code>dplyr</code> / <code>mutate()</code> method. This might seem a little challenging at first, but if you have completed Task 4 or at least looked at the sample solution, it is quite easy. You can pass anything to a new column within <code>mutate()</code> as long as it is a vector of the same length as the original dataframe.</p>
</div>
<div id="task-2-1" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Task 2</h3>
<p>We can now explore the newly created Values <code>stepMean</code> using summary statistics (histogramms, boxplot, <code>summary()</code>) and define a reasonable threshold value to differentiate between “stops” and “moves”. There is no “correct” way of doing this, specifying a threshold always depends on the question that needs to be answered.</p>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA&#39;s 
##    0.000    5.109   14.211   57.382   62.224 1811.620       40</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Based on this data, I will go with a threshold value of 15. Apply your threshold on you data (condition: <code>stepMean &gt; 15</code>).</p>
<p>Plot a <em>subset</em> of data to verify if the arbitrary threshold was a reasonable choice. - subsetting the first ten rows can be done with <code>[1:10,]</code> (dont forget the comma!) - we have a couple of NA values in the beginning and end of each trajectory. Use <code>filter(!is.na(moving))</code> to remove these values from the plot - if you add the layer <code>geom_sf()</code> <code>ggplot</code> will only plot points. To add the lines in between you’ll have to specify the x and y values (E and N) - add the layer <code>coord_sf(datum = 2056)</code> - wrap the whole plot function in <code>ggplotly()</code> if you want to enable zooming / panning</p>
<p><img src="_main_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="task-3-optional" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Task 3 (Optional)</h3>
<p>To be honest, exploring segmentation with <code>ggplot</code> (and even <code>plotly</code>) is not very satisfying. Another great tool to visualize spatial data is leaflet. It’s not all that hard to create a leaflet plot, just take a look at the documentation and try it with our segmented wild boar data.</p>
<div id="htmlwidget-580f5e68eae3fb7ab16c" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-580f5e68eae3fb7ab16c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addCircles","args":[[46.9937867,46.9938264,46.9937648,46.9938452,46.9938116,46.9957989,46.9957965,46.9958249,46.9959277,46.9963393,46.9964437,46.9965222,46.9963218,46.9963578,46.9965654,46.9964389,46.996499,46.9964744,46.9965099,46.9965474,46.9963882,46.996418,46.9966339,46.9963478,46.9962772,46.9963862,46.9964351,46.996442,46.9964163,46.9964286,46.9964199,46.9965486,46.9957771,46.9957743,46.9957252,46.995675,46.9956896,46.9957823,46.9959253,46.9957251,46.9958311,46.9955844,46.9957705,46.9940622,46.9939954,46.9939963,46.9939701,46.9939512,46.9939736,46.9939789,46.9939988,46.9940287,46.9938164,46.9939046,46.9939527,46.9939814,46.9940294,46.9939713,46.9939362,46.9940107,46.9940139,46.9940024,46.9938879,46.9939225,46.9939975,46.9940269,46.9940517,46.9939216,46.9939374,46.9940085,46.9942688,46.9921269,46.9913476,46.992975,46.9930631,46.993008,46.993053,46.9928841,46.9928612,46.9928469,46.9928422,46.9929024,46.995038,46.9976246,46.9950694,46.9964063,46.9964288,46.9964068,46.9964117,46.9963901,46.996443,46.996401,46.9964206,46.9964329,46.9964223,46.9964178,46.9964047,46.9964194,46.9964178,46.9964163,46.9964401,46.9963858,46.9963951,46.996419,46.9964198,46.9964228,46.9964141,46.9964402,46.9964083,46.9964321,46.9964166,46.996458,46.9964349,46.996319,46.9964471,46.9964394,46.996432,46.9964167,46.9964194,46.9964198,46.9963846,46.9963888,46.9959004,46.9974221,46.9955157,46.9924171,46.9923371,46.9929309,46.9929698,46.9929883,46.9929029,46.9928806,46.9922637,46.9922455,46.992187,46.9915094,46.9914898,46.9914642,46.9917124,46.991487,46.9915528,46.9914931,46.991503,46.9914862,46.9915944,46.9913494,46.991346,46.9914544,46.9915386,46.9914502,46.9914874,46.9915022,46.9914882,46.9914969,46.9915952,46.9915177,46.9915581,46.9914532,46.9915508,46.9915115,46.9915814,46.991504,46.991505,46.9915838,46.9914865,46.992193,46.9924326,46.9930445,46.9930563,46.9928221,46.9920751,46.9907789,46.9917531,46.9918309,46.9918692,46.9920833,46.9922865,46.9922832,46.9923085,46.9920421,46.9928408,46.992744,46.9929385,46.9923112,46.9921324,46.9915002,46.9915289,46.9915016,46.9914625,46.9914817,46.9914496,46.9915353,46.9915453,46.9914678,46.9914724,46.9914593,46.9914471,46.9913711],[7.0493667,7.0493292,7.0493359,7.049282,7.0494009,7.0519123,7.0517966,7.051658,7.0515876,7.0518024,7.0515023,7.051856,7.051708,7.0517048,7.0519878,7.0517354,7.0517957,7.0517957,7.0518885,7.0517857,7.0517127,7.0516849,7.0503409,7.0503073,7.0502944,7.0501101,7.0502891,7.0503086,7.0502875,7.0502712,7.0502695,7.0503509,7.0532236,7.0532135,7.0532611,7.0531761,7.0532334,7.0531795,7.0529105,7.0531877,7.0530814,7.0530495,7.0532382,7.0537408,7.0536857,7.0537135,7.0538035,7.0536808,7.0536807,7.0536775,7.0536418,7.0536073,7.0537531,7.0537477,7.0539711,7.0539154,7.053984,7.0538993,7.0538081,7.053901,7.0538651,7.0536088,7.0538426,7.0537365,7.0536858,7.0537774,7.0540327,7.0539845,7.0538292,7.0539009,7.0538876,7.0537289,7.0470418,7.0450306,7.0448446,7.0448855,7.0448773,7.045409,7.0453666,7.0454073,7.0454043,7.0453518,7.0434686,7.0413481,7.0433822,7.0424996,7.0424181,7.0424361,7.0424638,7.0424835,7.0423936,7.042454,7.0424426,7.0424588,7.0424899,7.0424638,7.0424769,7.042454,7.0424638,7.0425471,7.0423414,7.0424343,7.0424472,7.0424687,7.0424393,7.0424753,7.0424409,7.0424474,7.0424426,7.0424231,7.0424753,7.0424688,7.0424181,7.0422244,7.0424343,7.0424442,7.0423496,7.0423939,7.0424215,7.0424231,7.0424132,7.0424377,7.045315,7.0476966,7.0515736,7.0548682,7.0510693,7.0504652,7.0502533,7.0503431,7.0504507,7.0501833,7.0501187,7.0501271,7.050057,7.0489609,7.0489736,7.0489934,7.0488943,7.0489786,7.0488987,7.0489786,7.0488629,7.0489591,7.0490077,7.0488534,7.048896,7.0489054,7.0489966,7.0489786,7.0489802,7.0490145,7.0489346,7.0490014,7.0490586,7.0489786,7.0489605,7.0489819,7.0489394,7.0489948,7.0489882,7.0489816,7.0489607,7.0489491,7.0488872,7.0498613,7.05019,7.0501359,7.0502482,7.0504542,7.0525551,7.0529089,7.0557707,7.0560722,7.0560787,7.0561338,7.0558287,7.0557749,7.0556721,7.053985,7.0505522,7.0504118,7.0502434,7.0501448,7.0497098,7.0490064,7.048967,7.0488973,7.0489135,7.0489655,7.0489837,7.0489591,7.0489168,7.0489428,7.0489363,7.0489494,7.0489331,7.0489548],1,null,null,{"interactive":true,"className":"","stroke":true,"color":["#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#F8766D","#00BFC4","#F8766D","#00BFC4","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#F8766D","#00BFC4","#F8766D","#00BFC4","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#00BFC4","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D","#F8766D"],"fillOpacity":0.2},null,null,null,null,null,null]},{"method":"addPolylines","args":[[[[{"lng":[7.0493667,7.0493292,7.0493359,7.049282,7.0494009,7.0519123,7.0517966,7.051658,7.0515876,7.0518024,7.0515023,7.051856,7.051708,7.0517048,7.0519878,7.0517354,7.0517957,7.0517957,7.0518885,7.0517857,7.0517127,7.0516849,7.0503409,7.0503073,7.0502944,7.0501101,7.0502891,7.0503086,7.0502875,7.0502712,7.0502695,7.0503509,7.0532236,7.0532135,7.0532611,7.0531761,7.0532334,7.0531795,7.0529105,7.0531877,7.0530814,7.0530495,7.0532382,7.0537408,7.0536857,7.0537135,7.0538035,7.0536808,7.0536807,7.0536775,7.0536418,7.0536073,7.0537531,7.0537477,7.0539711,7.0539154,7.053984,7.0538993,7.0538081,7.053901,7.0538651,7.0536088,7.0538426,7.0537365,7.0536858,7.0537774,7.0540327,7.0539845,7.0538292,7.0539009,7.0538876,7.0537289,7.0470418,7.0450306,7.0448446,7.0448855,7.0448773,7.045409,7.0453666,7.0454073,7.0454043,7.0453518,7.0434686,7.0413481,7.0433822,7.0424996,7.0424181,7.0424361,7.0424638,7.0424835,7.0423936,7.042454,7.0424426,7.0424588,7.0424899,7.0424638,7.0424769,7.042454,7.0424638,7.0425471,7.0423414,7.0424343,7.0424472,7.0424687,7.0424393,7.0424753,7.0424409,7.0424474,7.0424426,7.0424231,7.0424753,7.0424688,7.0424181,7.0422244,7.0424343,7.0424442,7.0423496,7.0423939,7.0424215,7.0424231,7.0424132,7.0424377,7.045315,7.0476966,7.0515736,7.0548682,7.0510693,7.0504652,7.0502533,7.0503431,7.0504507,7.0501833,7.0501187,7.0501271,7.050057,7.0489609,7.0489736,7.0489934,7.0488943,7.0489786,7.0488987,7.0489786,7.0488629,7.0489591,7.0490077,7.0488534,7.048896,7.0489054,7.0489966,7.0489786,7.0489802,7.0490145,7.0489346,7.0490014,7.0490586,7.0489786,7.0489605,7.0489819,7.0489394,7.0489948,7.0489882,7.0489816,7.0489607,7.0489491,7.0488872,7.0498613,7.05019,7.0501359,7.0502482,7.0504542,7.0525551,7.0529089,7.0557707,7.0560722,7.0560787,7.0561338,7.0558287,7.0557749,7.0556721,7.053985,7.0505522,7.0504118,7.0502434,7.0501448,7.0497098,7.0490064,7.048967,7.0488973,7.0489135,7.0489655,7.0489837,7.0489591,7.0489168,7.0489428,7.0489363,7.0489494,7.0489331,7.0489548],"lat":[46.9937867,46.9938264,46.9937648,46.9938452,46.9938116,46.9957989,46.9957965,46.9958249,46.9959277,46.9963393,46.9964437,46.9965222,46.9963218,46.9963578,46.9965654,46.9964389,46.996499,46.9964744,46.9965099,46.9965474,46.9963882,46.996418,46.9966339,46.9963478,46.9962772,46.9963862,46.9964351,46.996442,46.9964163,46.9964286,46.9964199,46.9965486,46.9957771,46.9957743,46.9957252,46.995675,46.9956896,46.9957823,46.9959253,46.9957251,46.9958311,46.9955844,46.9957705,46.9940622,46.9939954,46.9939963,46.9939701,46.9939512,46.9939736,46.9939789,46.9939988,46.9940287,46.9938164,46.9939046,46.9939527,46.9939814,46.9940294,46.9939713,46.9939362,46.9940107,46.9940139,46.9940024,46.9938879,46.9939225,46.9939975,46.9940269,46.9940517,46.9939216,46.9939374,46.9940085,46.9942688,46.9921269,46.9913476,46.992975,46.9930631,46.993008,46.993053,46.9928841,46.9928612,46.9928469,46.9928422,46.9929024,46.995038,46.9976246,46.9950694,46.9964063,46.9964288,46.9964068,46.9964117,46.9963901,46.996443,46.996401,46.9964206,46.9964329,46.9964223,46.9964178,46.9964047,46.9964194,46.9964178,46.9964163,46.9964401,46.9963858,46.9963951,46.996419,46.9964198,46.9964228,46.9964141,46.9964402,46.9964083,46.9964321,46.9964166,46.996458,46.9964349,46.996319,46.9964471,46.9964394,46.996432,46.9964167,46.9964194,46.9964198,46.9963846,46.9963888,46.9959004,46.9974221,46.9955157,46.9924171,46.9923371,46.9929309,46.9929698,46.9929883,46.9929029,46.9928806,46.9922637,46.9922455,46.992187,46.9915094,46.9914898,46.9914642,46.9917124,46.991487,46.9915528,46.9914931,46.991503,46.9914862,46.9915944,46.9913494,46.991346,46.9914544,46.9915386,46.9914502,46.9914874,46.9915022,46.9914882,46.9914969,46.9915952,46.9915177,46.9915581,46.9914532,46.9915508,46.9915115,46.9915814,46.991504,46.991505,46.9915838,46.9914865,46.992193,46.9924326,46.9930445,46.9930563,46.9928221,46.9920751,46.9907789,46.9917531,46.9918309,46.9918692,46.9920833,46.9922865,46.9922832,46.9923085,46.9920421,46.9928408,46.992744,46.9929385,46.9923112,46.9921324,46.9915002,46.9915289,46.9915016,46.9914625,46.9914817,46.9914496,46.9915353,46.9915453,46.9914678,46.9914724,46.9914593,46.9914471,46.9913711]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.1,"fill":false,"fillColor":"#03F","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,null,null]},{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addLegend","args":[{"colors":["#F8766D","#00BFC4"],"labels":["FALSE","TRUE"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"topright","type":"factor","title":"Animal moving?","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[46.9907789,46.9976246],"lng":[7.0413481,7.0561338]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="task-4-1" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Task 4</h3>
<p>Use the package <code>recurse</code> (function <code>getRecursions</code>) to determin sites which are often visited. <!-- Todo: either extend this task or use this as a possible challange for the individual topics and replace this with similarity measures  --></p>
<p><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
</div>
</div>
<div id="solution-r-code" class="section level2">
<h2><span class="header-section-number">4.5</span> Solution (R Code)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(plotly)
<span class="kw">library</span>(CMAtools)
<span class="kw">library</span>(recurse)

## Task 1 ####################

wildschwein_BE_sf &lt;-<span class="st"> </span>wildschwein_BE_sf <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(TierID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">stepMean =</span> <span class="kw">rowMeans</span>(
      <span class="kw">cbind</span>(
        <span class="kw">euclid</span>(<span class="kw">lag</span>(E, <span class="dv">2</span>),<span class="kw">lag</span>(N, <span class="dv">2</span>),E,N),
        <span class="kw">euclid</span>(<span class="kw">lag</span>(E, <span class="dv">1</span>),<span class="kw">lag</span>(N, <span class="dv">1</span>),E,N),
        <span class="kw">euclid</span>(E,N,<span class="kw">lead</span>(E, <span class="dv">1</span>),<span class="kw">lead</span>(N, <span class="dv">1</span>)),
        <span class="kw">euclid</span>(E,N,<span class="kw">lead</span>(E, <span class="dv">2</span>),<span class="kw">lead</span>(N, <span class="dv">2</span>))
        )
      )
  )
## Task 2 ####################


<span class="kw">summary</span>(wildschwein_BE_sf<span class="op">$</span>stepMean)

<span class="kw">ggplot</span>(wildschwein_BE_sf, <span class="kw">aes</span>(stepMean)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">lims</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">15</span>)


wildschwein_BE_sf &lt;-<span class="st"> </span>wildschwein_BE_sf <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">moving =</span> stepMean <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span>
  )

wildschwein_BE_sf[<span class="dv">20</span><span class="op">:</span><span class="dv">50</span>,] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(moving)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> moving)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(E,N)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">datum =</span> <span class="dv">2056</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(
    <span class="dt">panel.grid.major =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;transparent&quot;</span>),
    <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>)
    ) 

## library(leaflet)
## library(scales)
## factpal &lt;- colorFactor(hue_pal()(2), wildschwein_BE_sf$moving)
## 
## # checking to see if this all makes sense in leaflet: (or better ggplot?)
## wildschwein_BE_sf[0:200,] %&gt;%
##   filter(!is.na(moving)) %&gt;%
##   leaflet() %&gt;%
##   addCircles(radius = 1,lng = ~Long, lat = ~Lat, color = ~factpal(moving)) %&gt;%
##   addPolylines(opacity = 0.1,lng = ~Long, lat = ~Lat) %&gt;%
##   addTiles() %&gt;%
##   addLegend(pal = factpal, values = ~moving, title = &quot;Animal moving?&quot;)

<span class="kw">library</span>(recurse)
<span class="kw">library</span>(ggforce)

recurs &lt;-<span class="st"> </span>wildschwein_BE_sf <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(TierID <span class="op">==</span><span class="st"> &quot;001A&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(E,N,DatetimeUTC,TierID) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">getRecursions</span>(<span class="dv">100</span>)

recurStats &lt;-<span class="st"> </span>recurs<span class="op">$</span>revisitStats

recurStats &lt;-<span class="st"> </span>recurStats <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(coordIdx) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">number_of_visits =</span> <span class="kw">max</span>(visitIdx),
    <span class="dt">x =</span> <span class="kw">unique</span>(x),
    <span class="dt">y =</span> <span class="kw">unique</span>(y),
    <span class="dt">total_time =</span> <span class="kw">sum</span>(timeInside),
    <span class="dt">max_time =</span> <span class="kw">max</span>(timeInside),
    <span class="dt">mean_time =</span> <span class="kw">mean</span>(timeInside)
  )

data1 =<span class="st"> </span><span class="kw">filter</span>(recurStats, number_of_visits <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>)
wildschwein_BE_sf <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(TierID <span class="op">==</span><span class="st"> &quot;001A&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(E,N)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_circle</span>(<span class="dt">data =</span> data1, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="kw">aes</span>(<span class="dt">x0 =</span> x,<span class="dt">y0 =</span> y,<span class="dt">fill =</span> mean_time,<span class="dt">r =</span> <span class="dv">100</span>),<span class="dt">inherit.aes =</span> F) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dv">1</span>)

## NA</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lesson-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lesson-4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
