<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>GEO880: Patterns and Trends in Environmental Data</title>
  <meta name="description" content="GEO880: Patterns and Trends in Environmental Data">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="GEO880: Patterns and Trends in Environmental Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="GEO880: Patterns and Trends in Environmental Data" />
  
  
  

<meta name="author" content="Patrick Laube and Nils Ratnaweera">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise-1.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction Chapter</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i>Exercise 1</a><ul>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#leaning-outcomes"><i class="fa fa-check"></i>Leaning outcomes</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#preperation"><i class="fa fa-check"></i>Preperation</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#tasks-and-inputs"><i class="fa fa-check"></i>Tasks and inputs</a><ul>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-1-initialize-project"><i class="fa fa-check"></i>Task 1: Initialize project</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-2-import-data"><i class="fa fa-check"></i>Task 2: Import data</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-3-explore-data"><i class="fa fa-check"></i>Task 3: Explore Data</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#input-1-handling-spatial-data"><i class="fa fa-check"></i>Input 1: Handling spatial data</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-4-project-data-from-wgs84"><i class="fa fa-check"></i>Task 4: Project data from WGS84</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#input-2-calculate-convex-hull"><i class="fa fa-check"></i>Input 2: Calculate Convex Hull</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-5-ploting-spatial-objects"><i class="fa fa-check"></i>Task 5: Ploting spatial objects</a></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#task-6-adding-a-background-map"><i class="fa fa-check"></i>Task 6: Adding a background map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-1.html"><a href="exercise-1.html#solutions-rcode"><i class="fa fa-check"></i>Solutions (RCode)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i>Exercise 2</a><ul>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#learning-outcomes"><i class="fa fa-check"></i>Learning Outcomes</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#preperation-1"><i class="fa fa-check"></i>Preperation</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#tasks-and-inputs-1"><i class="fa fa-check"></i>Tasks and Inputs</a><ul>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#input-1-using-dpyr-for-data-wrangling"><i class="fa fa-check"></i>Input 1: Using dpyr for data wrangling</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-1-getting-an-overview"><i class="fa fa-check"></i>Task 1: Getting an Overview</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#input-2-grouping-by-intervals"><i class="fa fa-check"></i>Input 2: Grouping by intervals</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-2-making-groups-by-sampling-interval"><i class="fa fa-check"></i>Task 2: Making groups by sampling Interval</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#input-3-geometry-as-columns"><i class="fa fa-check"></i>Input 3: Geometry as columns</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-3-euclidean-distance-and-speed"><i class="fa fa-check"></i>Task 3: Euclidean Distance and Speed</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-4-rolling-window-functions"><i class="fa fa-check"></i>Task 4: Rolling window functions</a></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#task-5-segmenting-methods"><i class="fa fa-check"></i>Task 5: Segmenting methods</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-2.html"><a href="exercise-2.html#solutions-rcode-1"><i class="fa fa-check"></i>Solutions (RCode)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEO880: Patterns and Trends in Environmental Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-2" class="section level1">
<h1>Exercise 2</h1>
<!-- Enrich trajectories (step length, speed, 5min/3hrs) -->
<!-- Simple multi-scale analysis (with dplyr summarize for 5min and 3hrs) -->
<!-- Moving windows -->
<!-- Map back in space -->
<div id="learning-outcomes" class="section level2">
<h2>Learning Outcomes</h2>
</div>
<div id="prerequisites-1" class="section level2">
<h2>Prerequisites</h2>
<p>Readings Skills from “R for Data Science” <span class="citation">(Wickham and Grolemund 2017)</span>:</p>
<ul>
<li>RS2.1 Chap3 Data Transformation with <code>dplyr</code> (31p, 43-76)</li>
<li>RS2.2 Chap10 Relational data with <code>dplyr</code> (21p, 171-193)</li>
<li>RS2.3 Chap14 Pipes with <code>magrittr</code> (6p, 261-268)</li>
</ul>
<p>Readings Theory</p>
<ul>
<li>R2.1 <span class="citation">Laube and Purves (2011)</span>: How fast is a cow? cross - scale analysis of movement data.</li>
</ul>
</div>
<div id="preperation-1" class="section level2">
<h2>Preperation</h2>
<p>Open your R Project from last week. Load all libraries and run the script to import and clean your data. <!-- Todo: I still fill as this makes sense, in light of reproducible research.  --></p>
<!-- Todo: add some comments as to what devtools does, and what CMAtools is -->
</div>
<div id="tasks-and-inputs-1" class="section level2">
<h2>Tasks and Inputs</h2>
<div id="input-1-using-dpyr-for-data-wrangling" class="section level3">
<h3>Input 1: Using dpyr for data wrangling</h3>
<p>Depending on your knowledge of <code>R</code>, getting an overview of the data we imported last week might have been quite a challenge. Quite surprisingly, importing, cleaning and exploring your data can be the most challenging, time consuming part of a project. RStudio and the tidyverse offer many helpful tools to make this part easier (and more fun). You have read chapters on <code>dplyr</code> and <code>magrittr</code> as preparation for this Exercise. In the next task, we will use these tools (<code>dplyr</code>, <code>group_by</code>, <code>summarise</code>) to get an overview of the data. Let’s start with an example to illustrate the concept:</p>
<p>To calculate the timelag in between subsequent positions, we can use the function <code>difftime()</code> combined with <code>lead()</code> from <code>dplyr</code>. Wihout <code>muatate()</code>, the code looks something like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE$timelag  &lt;-<span class="st"> </span><span class="kw">difftime</span>(<span class="kw">lead</span>(wildschwein_BE$DatetimeUTC),wildschwein_BE$DatetimeUTC)</code></pre></div>
<p>We mention <code>wildschwein_BE</code> three times in this function, which is why we can use <code>summarise()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wildschwein_BE  &lt;-<span class="st"> </span>wildschwein_BE %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">timelag =</span> <span class="kw">difftime</span>(<span class="kw">lead</span>(DatetimeUTC),DatetimeUTC)
  )
                                            </code></pre></div>
<p>With the code above, we did not consider that <code>timelag</code> should just be calculated between subsequent rows <em>of the same individual</em>. We can implement this by using <code>group_by()</code>. In addition, we can specify <code>units =</code> to ensure we’re getting the time difference in the units we prefer, and <code>as.numeric()</code> to turn the <code>difftime()</code> object into a numeric value (which is easier to plot etc.).</p>
</div>
<div id="task-1-getting-an-overview" class="section level3">
<h3>Task 1: Getting an Overview</h3>
<p>Try to answer the following questions:</p>
<ul>
<li>How many individuals were tracked?</li>
<li>How long were the individual tracked? Are there gaps?</li>
<li>Were all individuals tracked concurrently or sequentially?</li>
<li>What is the temporal sampling interval between the locations?</li>
</ul>
<p>Here are some sample visualisation that help answer these questions: <img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-28-2.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-28-3.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-28-4.png" width="672" /></p>
</div>
<div id="input-2-grouping-by-intervals" class="section level3">
<h3>Input 2: Grouping by intervals</h3>
<p>For the next Task, we will need a function to split a continuous variable into specific intervals. For this, the function <code>cut()</code>is very handy. Let’s introduce this function with a quick example. Take an a series of number that represent the age of ten different people.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">18</span>,<span class="dv">13</span>,<span class="dv">53</span>,<span class="dv">50</span>,<span class="dv">23</span>,<span class="dv">43</span>,<span class="dv">68</span>,<span class="dv">40</span>)</code></pre></div>
<p>Let’s say we want to split this into equal intervals of 10</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">10</span>)

<span class="kw">cut</span>(ages,<span class="dt">breaks =</span> breaks)
##  [1] (10,20] (20,30] (10,20] (10,20] &lt;NA&gt;    (40,50] (20,30] (40,50]
##  [9] &lt;NA&gt;    (30,40]
## Levels: (0,10] (10,20] (20,30] (30,40] (40,50]</code></pre></div>
<p>Note:</p>
<ul>
<li>If a number does not fit within an interval defined by <code>breaks =</code>, <code>cut()</code> will return <code>NA</code>.</li>
<li>The default <code>labels</code> with <code>(</code> and <code>]</code> might seem a little ugly and puzzling at first, but in fact they are <a href="https://en.wikipedia.org/wiki/Interval_%28mathematics%29#Notations_for_intervals">a standard form of notating intervals in mathematics</a></li>
<li>If you don’t like <code>(</code> and <code>]</code>, you can specify your own labels with the argument <code>labels =</code> (see below)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cut</span>(ages, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">60</span>,<span class="dv">100</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;young&quot;</span>,<span class="st">&quot;middle aged&quot;</span>,<span class="st">&quot;old&quot;</span>))
##  [1] young       young       young       young       middle aged
##  [6] middle aged young       middle aged old         middle aged
## Levels: young middle aged old</code></pre></div>
</div>
<div id="task-2-making-groups-by-sampling-interval" class="section level3">
<h3>Task 2: Making groups by sampling Interval</h3>
<p>Now that we’ve established that we have different sampling intervals (Task 1), we have to segment our trajectories in such a way, that we can perform further analysis during specific sampling intervals only. If we measure speed, or turning angles, we have to be very clear on what temporal (an thus spatial) scale we are performing this analysis.</p>
<p>We therefore have to define threshold to group segments with a similar sampling interval. Explore the dataset in more detail (e.g. using histograms at different scales), and choose reasonable threshold values to group the trajectories into different sampling intervals.</p>
<p>Note:</p>
<ul>
<li>It might make more sense to choose narrow group intervals at smaller time lags and wider groups intervals at higher time lags.</li>
<li>Store the group names in a new column named <code>samplingInt</code></li>
</ul>
</div>
<div id="input-3-geometry-as-columns" class="section level3">
<h3>Input 3: Geometry as columns</h3>
<p>Last week, we transformed our data from a <code>data.frame</code> to an <code>sf</code> object. This turned our <code>Lat</code>/<code>Long</code> Columns into a single geometry (list) column. While this is very handy for many spatial operations, accessing the coordinates directly becomes difficult. We therefore advised storing the information twice, once as a geometry and once as a numeric value. We did this for the values in <code>WGS84</code>, but yet for the <code>CH1903+ LV95</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
wildschwein_BE
## Simple feature collection with 141763 features and 8 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 2568153 ymin: 1201483 xmax: 2577023 ymax: 1207609
## epsg (SRID):    2056
## proj4string:    +proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs
## # A tibble: 141,763 x 9
## # Groups:   TierID [10]
##    TierID TierName CollarID DatetimeUTC           Lat  Long timelag
##    &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 001A   Ueli        12272 2014-05-28 21:01:14  47.0  7.05    14.1
##  2 001A   Ueli        12272 2014-05-28 21:15:18  47.0  7.05    14.9
##  3 001A   Ueli        12272 2014-05-28 21:30:13  47.0  7.05    15.0
##  4 001A   Ueli        12272 2014-05-28 21:45:11  47.0  7.05    15.4
##  5 001A   Ueli        12272 2014-05-28 22:00:33  47.0  7.05    14.7
##  6 001A   Ueli        12272 2014-05-28 22:15:16  47.0  7.05    15.0
##  7 001A   Ueli        12272 2014-05-28 22:30:14  47.0  7.05    14.9
##  8 001A   Ueli        12272 2014-05-28 22:45:09  47.0  7.05    15.0
##  9 001A   Ueli        12272 2014-05-28 23:00:12  47.0  7.05    14.9
## 10 001A   Ueli        12272 2014-05-28 23:15:08  47.0  7.05    15.1
## # ... with 141,753 more rows, and 2 more variables: samplingInt &lt;fct&gt;,
## #   geometry &lt;POINT [m]&gt;</code></pre></div>
<p>Let’s do the same for the <code>CH1903+ LV95</code>-Value, we will need the values in columns for our next task. First, we have to extract the Coordinates using <code>st_coordinates()</code>. We can store these values in a new variable and display them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Store coordinates in a new variable</span>
coordinates &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(wildschwein_BE)

<span class="kw">head</span>(coordinates)
##         X       Y
## 1 2570390 1204820
## 2 2570389 1204826
## 3 2570391 1204821
## 4 2570388 1204826
## 5 2570388 1204819
## 6 2570384 1204828</code></pre></div>
<p>Note that that the column are named <code>X</code> and <code>Y</code>, while <a href="https://www.swisstopo.admin.ch/de/wissen-fakten/geodaesie-vermessung/neue-koordinaten.html">CH1903+ LV95</a> names the Axes <code>E</code> and <code>N</code>: let’s rename the columns appropriately. After this, we can use <code>cbind()</code> to “glue” the columns to our original <code>sf</code>-object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(coordinates) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;E&quot;</span>,<span class="st">&quot;N&quot;</span>)

wildschwein_BE &lt;-<span class="st"> </span><span class="kw">cbind</span>(wildschwein_BE,coordinates)</code></pre></div>
</div>
<div id="task-3-euclidean-distance-and-speed" class="section level3">
<h3>Task 3: Euclidean Distance and Speed</h3>
<p>In this task we will calculate the animal’s speed based on the distance and timelag in between locations. Since we have</p>
<ul>
<li>If you’re working with dplyr, you can add <code>samplingInt</code> to <code>group_by()</code> (in addition to TierID) and so make sure you’re not calculating speed across different sampling intervals.</li>
<li>You can use the function <code>euclid()</code> from the <code>CMAtools</code> package to calculate Euclidean distances between subsequent rows. Use ?euclid to see what the function expects and returns.</li>
<li>use <code>lead(E,1)</code> to address the the row <code>n+1</code></li>
<li>make sure you’re clear in what unit you are measuring speed. Meters per second is a SI base unit, but might be unhandy for the speeds travelled by wild boar.</li>
</ul>
</div>
<div id="task-4-rolling-window-functions" class="section level3">
<h3>Task 4: Rolling window functions</h3>
<p>Measuring speed between subsequent samples is great, but especially for short sampling intervals they can be misleading due to measurement error. It might be desirable to <em>smoothen</em> these errors using a <a href="https://docs.wavefront.com/images/5sec_moving_window.png">moving window function</a>. The <code>zoo</code> package offers a variate of moving window functions (<code>roll*</code>). Use <code>roll_mean()</code> to smooth the calculated speed. Familiarise yourself with this function by working on some dummy data, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(zoo)

example &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)
<span class="kw">rollmean</span>(example,<span class="dt">k =</span> <span class="dv">3</span>,<span class="dt">fill =</span> <span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>)
<span class="kw">rollmean</span>(example,<span class="dt">k =</span> <span class="dv">4</span>,<span class="dt">fill =</span> <span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>)</code></pre></div>
<p>Visualize the output from your moving windows and compare different window sizes (<code>k =</code>).</p>
</div>
<div id="task-5-segmenting-methods" class="section level3">
<h3>Task 5: Segmenting methods</h3>
<p>You’ve read <span class="citation">Laube and Purves (2011)</span> about segmenting trajectories. In the paper, they define “<em>static</em>” fixes as “<em>those whose average Euclidean distance to other fixes inside a temporal window </em>v* is less than some threshold *d**“. This sounds more complicated than it is, the figure illustrates the method nicely.</p>
<div class="figure">
<img src="02_Images/laube_2011.jpg" />

</div>
<p>Try to implement this method on some dummy data. Once you’ve solved the problem on this simple data, we will implement it on the wild boar data next week.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">10</span>)
X =<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">rnorm</span>(<span class="dv">20</span>))
Y =<span class="st"> </span><span class="kw">cumsum</span>(<span class="kw">rnorm</span>(<span class="dv">20</span>))

<span class="kw">plot</span>(X,Y, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Assume the sampling interval is 5 minutes. If we take a temporal window of 20 minutes, that would mean we include 5 fixes into the calculation. We need to calculate the following Euclidean distances (pos representing a <code>X</code>,<code>Y</code>-position):</p>
<ol style="list-style-type: decimal">
<li>pos[n-2] to pos[n]</li>
<li>pos[n-1] to pos[n]</li>
<li>pos[n] to pos[n+1]</li>
<li>pos[n] to pos[n+2]</li>
</ol>
<p>You can use the function <code>euclid()</code> to calculate the distances and <code>dplyr</code> functions <code>lead()/``lag()</code> to create the necessary offsets. On our dummy data, we want to calculate the mean of the following distances (red, dotted lines).</p>
<p><img src="_main_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
</div>
</div>
<div id="solutions-rcode-1" class="section level2">
<h2>Solutions (RCode)</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages(&quot;zoo&quot;)</span>
<span class="co"># </span>
<span class="co"># devtools::install_git(&quot;https://github.engineering.zhaw.ch/PatternsTrendsEnvironmentalData/CMAtools.git&quot;)</span>
## wildschwein_BE$timelag  &lt;- difftime(lead(wildschwein_BE$DatetimeUTC),wildschwein_BE$DatetimeUTC)
## wildschwein_BE  &lt;- wildschwein_BE %&gt;%
##   mutate(
##     timelag = difftime(lead(DatetimeUTC),DatetimeUTC)
##   )
## 
wildschwein_BE &lt;-<span class="st"> </span>wildschwein_BE %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(TierID) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">timelag =</span> <span class="kw">difftime</span>(<span class="kw">lead</span>(DatetimeUTC),DatetimeUTC,<span class="dt">units =</span> <span class="st">&quot;mins&quot;</span>),
    <span class="dt">timelag =</span> <span class="kw">as.numeric</span>(timelag)
  )
## Task 1 ####################

<span class="kw">ggplot</span>(wildschwein_BE, <span class="kw">aes</span>(DatetimeUTC,TierID)) +
<span class="st">  </span><span class="kw">geom_line</span>()

<span class="kw">ggplot</span>(wildschwein_BE, <span class="kw">aes</span>(timelag)) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">50</span>)

<span class="kw">ggplot</span>(wildschwein_BE, <span class="kw">aes</span>(timelag)) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) +
<span class="st">  </span><span class="kw">lims</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) +
<span class="st">  </span><span class="kw">scale_y_log10</span>()

wildschwein_BE[<span class="dv">1</span>:<span class="dv">50</span>,] %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(DatetimeUTC,timelag)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_point</span>()


ages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">20</span>,<span class="dv">25</span>,<span class="dv">18</span>,<span class="dv">13</span>,<span class="dv">53</span>,<span class="dv">50</span>,<span class="dv">23</span>,<span class="dv">43</span>,<span class="dv">68</span>,<span class="dv">40</span>)
breaks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">10</span>)

<span class="kw">cut</span>(ages,<span class="dt">breaks =</span> breaks)
<span class="kw">cut</span>(ages, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">30</span>,<span class="dv">60</span>,<span class="dv">100</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;young&quot;</span>,<span class="st">&quot;middle aged&quot;</span>,<span class="st">&quot;old&quot;</span>))
## Task 2 ####################

<span class="kw">ggplot</span>(wildschwein_BE, <span class="kw">aes</span>(timelag)) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">400</span>,<span class="dv">20</span>),<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">400</span>)) +
<span class="st">  </span><span class="co"># scale_x_continuous(breaks = seq(0,50,1),limits = c(0,50)) +</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>()

wildschwein_BE &lt;-<span class="st"> </span>wildschwein_BE %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(TierID) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">samplingInt =</span> <span class="kw">cut</span>(timelag,<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="kw">seq</span>(<span class="dv">10</span>,<span class="dv">195</span>,<span class="dv">15</span>)))
  ) 

wildschwein_BE %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(samplingInt) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">n =</span> <span class="kw">n</span>()
  ) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(samplingInt,n)) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>)) +
<span class="st">  </span><span class="kw">scale_y_log10</span>()



wildschwein_BE

<span class="co"># Store coordinates in a new variable</span>
coordinates &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(wildschwein_BE)

<span class="kw">head</span>(coordinates)
<span class="kw">colnames</span>(coordinates) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;E&quot;</span>,<span class="st">&quot;N&quot;</span>)

wildschwein_BE &lt;-<span class="st"> </span><span class="kw">cbind</span>(wildschwein_BE,coordinates)
## Task 3 ####################

<span class="kw">library</span>(CMAtools)

wildschwein_BE &lt;-<span class="st"> </span>wildschwein_BE %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(TierID,samplingInt) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">steplength =</span> <span class="kw">euclid</span>(<span class="kw">lead</span>(E),<span class="kw">lead</span>(N),E,N),
    <span class="dt">speed =</span> steplength/timelag
  )




<span class="kw">library</span>(zoo)

example &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)
<span class="kw">rollmean</span>(example,<span class="dt">k =</span> <span class="dv">3</span>,<span class="dt">fill =</span> <span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>)
<span class="kw">rollmean</span>(example,<span class="dt">k =</span> <span class="dv">4</span>,<span class="dt">fill =</span> <span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>)

## Task 4 ####################


wildschwein_BE &lt;-<span class="st"> </span>wildschwein_BE %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(TierID) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">speed2 =</span> <span class="kw">rollmean</span>(speed,<span class="dv">3</span>,<span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>),
    <span class="dt">speed3 =</span> <span class="kw">rollmean</span>(speed,<span class="dv">5</span>,<span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>),
    <span class="dt">speed4 =</span> <span class="kw">rollmean</span>(speed,<span class="dv">10</span>,<span class="ot">NA</span>,<span class="dt">align =</span> <span class="st">&quot;left&quot;</span>)
  )

wildschwein_BE[<span class="dv">1</span>:<span class="dv">30</span>,] %&gt;%
<span class="st">  </span><span class="kw">gather</span>(key,val,<span class="kw">c</span>(speed,speed2,speed3,speed4)) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(DatetimeUTC,val,<span class="dt">colour =</span> key,<span class="dt">group =</span> key)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_line</span>() 

## Task 5 ####################

nMinus2 &lt;-<span class="st"> </span><span class="kw">euclid</span>(<span class="kw">lag</span>(X, <span class="dv">2</span>),<span class="kw">lag</span>(Y, <span class="dv">2</span>),X,Y)  <span class="co"># distance to pos. -10 minutes</span>
nMinus1 &lt;-<span class="st"> </span><span class="kw">euclid</span>(<span class="kw">lag</span>(X, <span class="dv">1</span>),<span class="kw">lag</span>(Y, <span class="dv">1</span>),X,Y)  <span class="co"># distance to pos.  -5 minutes</span>
nPlus1  &lt;-<span class="st"> </span><span class="kw">euclid</span>(X,Y,<span class="kw">lead</span>(X, <span class="dv">1</span>),<span class="kw">lead</span>(Y, <span class="dv">1</span>)) <span class="co"># distance to pos   +5 mintues</span>
nPlus2  &lt;-<span class="st"> </span><span class="kw">euclid</span>(X,Y,<span class="kw">lead</span>(X, <span class="dv">2</span>),<span class="kw">lead</span>(Y, <span class="dv">2</span>)) <span class="co"># distance to pos  +10 minutes</span>

<span class="co"># Use cbind to bind all rows to a matrix</span>
distances &lt;-<span class="st"> </span><span class="kw">cbind</span>(nMinus2,nMinus1,nPlus1,nPlus2)
distances

<span class="co"># This just gives us the overall mean</span>
<span class="kw">mean</span>(distances, <span class="dt">na.rm =</span> T)

<span class="co"># We therefore need the function `rowMeans()`</span>
rowmeans &lt;-<span class="st"> </span><span class="kw">rowMeans</span>(distances)
<span class="kw">cbind</span>(distances,rowmeans)

<span class="co"># and if we put it all together:</span>
<span class="kw">rowMeans</span>(
  <span class="kw">cbind</span>(
    <span class="kw">euclid</span>(<span class="kw">lag</span>(X, <span class="dv">2</span>),<span class="kw">lag</span>(Y, <span class="dv">2</span>),X,Y),
    <span class="kw">euclid</span>(<span class="kw">lag</span>(X, <span class="dv">1</span>),<span class="kw">lag</span>(Y, <span class="dv">1</span>),X,Y),  
    <span class="kw">euclid</span>(X,Y,<span class="kw">lead</span>(X, <span class="dv">1</span>),<span class="kw">lead</span>(Y, <span class="dv">1</span>)), 
    <span class="kw">euclid</span>(X,Y,<span class="kw">lead</span>(X, <span class="dv">2</span>),<span class="kw">lead</span>(Y, <span class="dv">2</span>))
  )
)
## NA</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
